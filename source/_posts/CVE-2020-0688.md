---
title: CVE-2020-0688 Microsoft Exchange远程代码执行漏洞 Exploit
tags: 
- CVE
- 漏洞
top_img: /img/yangb.png
cover: /img/CVE.png
categories:
- 技术分享
---

## 漏洞说明
微软邮件服务器Microsoft Exchange Server爆出远程代码执行漏洞.  
该漏洞是由于Exchange Control Panel(ECP)组件中使用了静态秘钥（validationKey和decryptionKey）所导致的。

所有Microsoft Exchange Server在安装后的web.config文件中都拥有相同的validationKey和decryptionKey。这些密钥用于保证ViewState的安全性。而ViewState是ASP.NET Web应用以序列化格式存储在客户机上的服务端数据。客户端通过__VIEWSTATE请求参数将这些数据返回给服务器。

经过身份验证的攻击者可以从身份验证的session中收集ViewStateUserKey，并在登录请求的原始响应中获得__VIEWSTATEGENERATOR。通过这两个值可以利用YSoSerial.net工具生成恶意的ViewState，从而在ECP中执行任意的.NET代码。由于ECP应用程序是以SYSTEM权限运行的，因而成功利用此漏洞的攻击者可以以SYSTEM身份执行任意代码，并完全控制目标Exchange服务器。

## 受影响版本

* Microsoft Exchange Server 2010 Service Pack 3 Update Rollup 30
* Microsoft Exchange Server 2013 Cumulative Update 23
* Microsoft Exchange Server 2016 Cumulative Update 14
* Microsoft Exchange Server 2016 Cumulative Update 15
* Microsoft Exchange Server 2019 Cumulative Update 3
* Microsoft Exchange Server 2019 Cumulative Update 4


## Exp 漏洞利用
```sh
$ git clone https://github.com/yangb92/cve-2020-0688.git
$ cd cve-2020-0688
$ python cve-2020-0688.py -s https://ip/owa/ -u user -p pass -c "shutdown -s -t 0" # 发送关闭服务器命令
```

> 实战经验: 
>1. 要先注册该邮件服务器的邮箱账号,拿到邮箱账号之后才能利用该漏洞拿到服务器的shell.
